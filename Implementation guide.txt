# Study Buddy - Production Implementation Guide

## Phase 1: Pre-Launch Essentials (Integrate into Weeks 1-3)

### 1. Error Handling & Crash Reporting (2 days)

#### A. Install Sentry
```bash
npm install @sentry/react-native
cd ios && pod install
npx @sentry/wizard -i reactNative -p ios android
```

#### B. Create Error Boundary Component
```javascript
// src/components/ErrorBoundary.js
import React from 'react';
import { View, Text, TouchableOpacity, StyleSheet } from 'react-native';
import * as Sentry from '@sentry/react-native';

class ErrorBoundary extends React.Component {
  state = { hasError: false, error: null };

  static getDerivedStateFromError(error) {
    return { hasError: true, error };
  }

  componentDidCatch(error, errorInfo) {
    Sentry.captureException(error, { extra: errorInfo });
  }

  resetError = () => {
    this.setState({ hasError: false, error: null });
  };

  render() {
    if (this.state.hasError) {
      return (
        <View style={styles.container}>
          <Text style={styles.emoji}>ðŸ˜¢</Text>
          <Text style={styles.title}>Oops! Something went wrong</Text>
          <Text style={styles.message}>
            Don't worry, your buddy is just taking a quick break!
          </Text>
          <TouchableOpacity style={styles.button} onPress={this.resetError}>
            <Text style={styles.buttonText}>Try Again</Text>
          </TouchableOpacity>
        </View>
      );
    }
    return this.props.children;
  }
}
```

#### C. Wrap App with Error Handling
```javascript
// App.js updates
import * as Sentry from '@sentry/react-native';
import ErrorBoundary from './src/components/ErrorBoundary';

Sentry.init({
  dsn: 'YOUR_SENTRY_DSN',
  environment: __DEV__ ? 'development' : 'production',
  beforeSend(event) {
    // Don't send events in development
    if (__DEV__) return null;
    // Filter out non-critical errors
    if (event.level === 'warning') return null;
    return event;
  },
});

export default function App() {
  return (
    <ErrorBoundary>
      <SubscriptionContext.Provider value={{ isPremium, checkPremiumStatus }}>
        {/* Rest of app */}
      </SubscriptionContext.Provider>
    </ErrorBoundary>
  );
}
```

### 2. Critical E2E Tests (3 days)

#### A. Install Detox
```bash
npm install --save-dev detox @types/detox jest
npm install --save-dev detox-expo-helpers expo-detox-hook
```

#### B. Core Test Implementation
```javascript
// test/e2e/critical-paths.test.js
describe('Critical User Paths', () => {
  beforeAll(async () => {
    await device.launchApp({ 
      newInstance: true,
      permissions: { notifications: 'YES', camera: 'YES' }
    });
  });

  describe('First Time User Experience', () => {
    it('should complete onboarding in under 30 seconds', async () => {
      // Test implementation
      await expect(element(by.id('welcome-screen'))).toBeVisible();
      await element(by.id('age-8-10')).tap();
      await element(by.id('buddy-cat')).tap();
      await element(by.id('start-button')).tap();
      
      // Verify we're on main screen
      await expect(element(by.id('mode-selection'))).toBeVisible();
      
      // Verify data saved
      // Add timing assertion
    });
  });

  describe('Core Study Session', () => {
    it('should complete a full study session', async () => {
      await element(by.id('study-mode-button')).tap();
      await element(by.id('subject-math')).tap();
      await element(by.id('start-session')).tap();
      
      // Verify timer starts
      await expect(element(by.id('timer-display'))).toBeVisible();
      
      // Fast forward to check-in (mock timer)
      await device.shake(); // Trigger dev menu
      await element(by.text('Trigger Check-in')).tap();
      
      // Verify check-in appears
      await expect(element(by.id('checkin-message'))).toBeVisible();
      
      // Complete session
      await element(by.id('end-session')).tap();
      await expect(element(by.id('celebration-screen'))).toBeVisible();
    });
  });

  describe('Parent Settings Protection', () => {
    it('should require math answer to access settings', async () => {
      await element(by.id('settings-button')).tap();
      await expect(element(by.id('parent-gate'))).toBeVisible();
      
      // Get math question and solve it
      const question = await element(by.id('math-question')).getAttributes();
      // Parse and solve...
      
      await element(by.id('math-answer')).typeText('42');
      await element(by.id('submit-answer')).tap();
      
      await expect(element(by.id('parent-settings'))).toBeVisible();
    });
  });
});
```

### 3. Actual Assets Creation (2 days)

#### A. Quick Asset Generation
```bash
# Use free tools for MVP:
# 1. Icons - Use Canva or Figma templates
# 2. Animations - Download from LottieFiles
# 3. Sounds - Generate with AI or use Freesound.org

# Create asset structure:
mkdir -p assets/{animations,sounds,images}
```

#### B. Asset Integration Checklist
```javascript
// src/assets/index.js
export const ASSETS = {
  animations: {
    catStudying: require('./animations/cat-studying.json'),
    dogStudying: require('./animations/dog-studying.json'),
    robotStudying: require('./animations/robot-studying.json'),
    celebration: require('./animations/celebration.json'),
    breathing: require('./animations/breathing-circle.json'),
  },
  sounds: {
    checkIn: require('./sounds/gentle-bell.mp3'),
    success: require('./sounds/success-chime.mp3'),
    celebration: require('./sounds/celebration.mp3'),
    tick: require('./sounds/soft-tick.mp3'),
  },
  images: {
    icon: require('./images/icon.png'),
    splash: require('./images/splash.png'),
  }
};
```

### 4. Performance Monitoring (1 day)

#### A. Add Performance Tracking
```javascript
// src/utils/performance.js
import * as Sentry from '@sentry/react-native';

export const trackPerformance = {
  measureScreenLoad: (screenName) => {
    const transaction = Sentry.startTransaction({
      name: `Screen Load: ${screenName}`,
    });
    return () => transaction.finish();
  },
  
  trackRenderTime: async (componentName, renderFn) => {
    const start = Date.now();
    const result = await renderFn();
    const duration = Date.now() - start;
    
    if (duration > 100) { // Log slow renders
      Sentry.captureMessage(`Slow render: ${componentName}`, {
        level: 'warning',
        extra: { duration }
      });
    }
    return result;
  }
};
```

## Phase 2: Launch Week Additions

### 5. Analytics Implementation (1 day)

```javascript
// src/utils/analytics.js
import * as Sentry from '@sentry/react-native';

class Analytics {
  trackEvent(eventName, properties = {}) {
    // Add to Sentry as breadcrumb
    Sentry.addBreadcrumb({
      message: eventName,
      category: 'user-action',
      data: properties,
    });
    
    // If using Mixpanel/Amplitude later
    // Mixpanel.track(eventName, properties);
  }
  
  trackScreen(screenName) {
    this.trackEvent('screen_view', { screen: screenName });
  }
  
  trackTiming(category, value) {
    this.trackEvent('timing', { category, value });
  }
}

export default new Analytics();
```

### 6. Privacy & Legal (1 day)

#### A. Generate Documents
```markdown
# Use Termly.io or similar service to generate:
1. Privacy Policy
2. Terms of Service
3. COPPA Compliance Statement

# Host on GitHub Pages:
https://yourusername.github.io/study-buddy-legal/privacy
https://yourusername.github.io/study-buddy-legal/terms
```

#### B. In-App Integration
```javascript
// src/screens/LegalScreen.js
import { WebView } from 'react-native-webview';

export default function LegalScreen({ route }) {
  const { type } = route.params;
  const urls = {
    privacy: 'https://yourusername.github.io/study-buddy-legal/privacy',
    terms: 'https://yourusername.github.io/study-buddy-legal/terms',
  };
  
  return <WebView source={{ uri: urls[type] }} />;
}
```

## Phase 3: Post-Launch Improvements (Week 4+)

### 7. CI/CD Pipeline Setup

```yaml
# .github/workflows/ci.yml
name: CI
on: [push, pull_request]

jobs:
  test:
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-node@v2
      - run: npm ci
      - run: npm run test:unit
      - run: npm run test:e2e:critical
      
  build:
    needs: test
    runs-on: macos-latest
    steps:
      - uses: actions/checkout@v2
      - run: npm ci
      - run: npm run build:ios
      - run: npm run build:android
```

### 8. Accessibility Enhancements

```javascript
// src/utils/accessibility.js
export const a11y = {
  // Ensure all interactive elements have labels
  button: (label, hint) => ({
    accessible: true,
    accessibilityLabel: label,
    accessibilityHint: hint,
    accessibilityRole: 'button',
  }),
  
  // Announce important changes
  announce: (message) => {
    AccessibilityInfo.announceForAccessibility(message);
  },
};
```

## Implementation Priority Order

**Week 1 (Alongside MVP Development):**
1. âœ… Error boundaries and crash reporting (2 hours)
2. âœ… Basic E2E test setup (4 hours)
3. âœ… Asset creation/download (4 hours)

**Week 2 (Testing Phase):**
4. âœ… Complete E2E test suite (2 days)
5. âœ… Performance monitoring setup (4 hours)
6. âœ… Privacy documents (2 hours)

**Week 3 (Launch Prep):**
7. âœ… Analytics implementation (4 hours)
8. âœ… Platform-specific fixes (1 day)
9. âœ… Support email setup (2 hours)

**Post-Launch:**
10. CI/CD pipeline (1 day)
11. Advanced accessibility (2 days)
12. Security hardening (1 day)
13. Update mechanism (1 day)

## Quick Start Commands

```bash
# Start with error handling
npm install @sentry/react-native
npx @sentry/wizard -i reactNative -p ios android

# Add E2E testing
npm install --save-dev detox
npm run test:e2e:setup

# Generate assets quickly
# Use Canva templates: https://www.canva.com/templates/?query=app+icon
# Download from LottieFiles: https://lottiefiles.com/featured

# Create privacy policy
# Go to: https://www.termly.io/products/privacy-policy-generator/
```

## Success Criteria

Before launch, ensure:
- [ ] Crash reporting active
- [ ] Critical E2E tests pass
- [ ] All assets integrated
- [ ] Privacy policy live
- [ ] Support email working
- [ ] App store materials ready
- [ ] Beta feedback incorporated

This keeps you on track for the 3-week timeline while ensuring production quality!